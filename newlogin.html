<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Login - BloodConnect</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"/>
  <link rel="stylesheet" href="bloodconnect.css"/>
</head>
<body>
  <div class="login-card">
    <div class="login-title"><i class="fas fa-sign-in-alt"></i> Login to <br>BloodConnect</div>
    <form class="login-form" id="loginForm">
      <div class="form-group">
        <label class="form-label" for="email">Email</label>
        <div class="form-input-wrapper">
          <span class="form-icon"><i class="fas fa-envelope"></i></span>
          <input class="form-input" type="email" id="email" placeholder="Email" required />
        </div>
      </div>
      <div class="form-group">
        <label class="form-label" for="password">Password</label>
        <div class="form-input-wrapper">
          <span class="form-icon"><i class="fas fa-lock"></i></span>
          <input class="form-input" type="password" id="password" placeholder="Password" required />
        </div>
      </div>
      <button type="submit" class="login-btn">Login</button>
      <div id="loginError" class="login-message-error"></div>
      <div id="signupSuccess" class="login-message-success"></div>
    </form>
    <div class="login-footer">
      Don't have an account?
      <a href="signup.html">Sign Up</a>
    </div>
    <a href="index.html" class="back-link"><i class="fas fa-arrow-left"></i> Back to Home</a>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm"></script>
  <script type="module">
    import { supabase } from './supabaseClient.js';
    // Show signup success message if redirected from signup
    window.addEventListener('DOMContentLoaded', function() {
      const params = new URLSearchParams(window.location.search);
      if (params.get('signup') === 'success') {
        document.getElementById('signupSuccess').textContent = 'Sign up successful! Please log in.';
      }
    });
    document.getElementById('loginForm').onsubmit = async function(e) {
      e.preventDefault();
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      const errorDiv = document.getElementById('loginError');
      errorDiv.textContent = '';
      errorDiv.style.color = '#e53935';
      // Email validation
      const emailPattern = /^[a-zA-Z0-9._%+-]+@gmail\.com$/;
      if (!emailPattern.test(email)) {
        errorDiv.textContent = 'Please enter a valid Gmail address.';
        return;
      }
      // Password validation
      if (password.length < 8) {
        errorDiv.textContent = 'Password must be at least 8 characters.';
        return;
      }
      errorDiv.textContent = 'Logging in...';
      try {
        const { data, error } = await supabase.auth.signInWithPassword({ email, password });
        if (error) {
          errorDiv.textContent = 'Login failed: ' + error.message;
          errorDiv.style.color = '#e53935';
          return;
        }
        errorDiv.style.color = '#388e3c';
        errorDiv.textContent = 'Login successful! Redirecting...';
        this.reset();
        setTimeout(() => {
          window.location.href = 'post-login.html';
        }, 1200);
      } catch (err) {
        errorDiv.textContent = 'Login failed: ' + err.message;
        errorDiv.style.color = '#e53935';
      }
    };
  </script>
</body>
</html>
